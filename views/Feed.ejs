<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Manage Blogs</title>
    <link rel="icon" type="image/x-icon" href="images/journal-bookmark-fill.svg">
    <style>body {
        background-color: #343a40; /* Dark background */
        color: #ffffff; /* Text color */
    }
    .cover-container {
        display: flex;
        flex-direction: column;
        align-items: center; /* Center horizontally */
        justify-content: center; /* Center vertically */
        min-height: 100vh; /* Full viewport height */
    }
    .nav-masthead {
        background-color: #6c757d; /* Dark grey background */
        padding: 10px; /* Add some padding */
        width: 100%; /* Full width */
    }
    .btn-custom {
        margin: 0 10px;
        background-color: #495057; /* Match the dark template */
        border: none; /* Remove border */
        color: #ffffff; /* Ensure the text is white */
    }
        body {
            background-color: #212529; /* Darker background for body */
            color: #ffffff; /* Text color */
        }
        h1 {
            text-align: center; /* Center the heading */
            margin-top: 20px; /* Margin for spacing */
        }
        .navbar {
            background-color: #007bff; /* Bright blue for the navbar */
            color: #ffffff; /* White text in navbar */
        }
        .navbar a {
            color: #ffffff; /* White links in navbar */
        }
        .blog-card {
            background-color: #343a40; /* Dark background for cards */
            border: 1px solid #6c757d; /* Border for seamless layout */
            margin-bottom: 20px; /* Spacing between cards */
            position: relative; /* For absolute positioning of buttons */
            padding: 15px; /* Padding for aesthetics */
            border-radius: 8px; /* Rounded corners for cards */
        }
        .edit-delete-buttons {
            position: absolute; /* Position buttons absolutely */
            top: 10px; /* Position from the top */
            right: 10px; /* Position from the right */
            display: none; /* Hide by default */
        }
        .blog-card:hover .edit-delete-buttons {
            display: block; /* Show buttons on hover */
        }
        .modal-content {
            background-color: #495057; /* Match the dark template */
            color: #ffffff; /* Text color */
        }
    </style>
</head>
<body>
    <%- include('partials/header.ejs') %>
    <div class="container">
        <h1>Blogs</h1>

        <!-- Button to trigger modal for adding a new blog post -->
        <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">Add New Blog Post</button>

        <div class="row">
            <% blogPosts.forEach((post, index) => { %>
                <div class="col-md-4">
                    <div class="blog-card">
                        <h5><%= post.author %></h5>
                        <p><%= post.content %></p>
                        <div class="edit-delete-buttons">
                            <button type="button" class="btn btn-warning me-2" data-bs-toggle="modal" data-bs-target="#editModal" data-index="<%= index %>" data-author="<%= post.author %>" data-content="<%= post.content %>">Edit</button>
                            <form action="/delete/<%= index %>" method="POST" class="d-inline">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>

    <!-- Add New Blog Post Modal -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addModalLabel">New Blog Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="/add" method="POST">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="author" class="form-label">Author:</label>
                            <input type="text" class="form-control" id="author" name="author" required placeholder="Author's name">
                        </div>
                        <div class="mb-3">
                            <label for="newContent" class="form-label">New Blog Post:</label>
                            <textarea class="form-control" id="newContent" name="content" rows="3" required placeholder="Write your blog post here..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Add Post</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Blog Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editForm" method="POST">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editAuthor" class="form-label">Author:</label>
                            <input type="text" class="form-control" id="editAuthor" name="author" required>
                        </div>
                        <div class="mb-3">
                            <label for="modalTextarea" class="form-label">Blog Post:</label>
                            <textarea name="content" id="modalTextarea" class="form-control" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Handle showing the edit modal
        var editModal = document.getElementById('editModal');
        editModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var index = button.getAttribute('data-index');
            var author = button.getAttribute('data-author');
            var content = button.getAttribute('data-content');
            var modalTextarea = editModal.querySelector('#modalTextarea');
            var editAuthor = editModal.querySelector('#editAuthor');
            var editForm = document.getElementById('editForm');

            modalTextarea.value = content;
            editAuthor.value = author;
            editForm.action = '/edit/' + index;
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
